import { Injectable } from '@angular/core';
import { GdaToastComponent } from './gda-toast.component';
import * as i0 from "@angular/core";
export class GdaToastConfig {
    constructor(direction = 'top-right', classToast = '', styleToast = {}, timing = 3000) {
        this.direction = direction;
        this.classToast = classToast;
        this.styleToast = styleToast;
        this.timing = timing;
    }
}
class GdaToastConfigForComponent extends GdaToastConfig {
    constructor(id = '') {
        super();
        this.id = id;
    }
}
export class GdaToast {
    constructor(componentFactoryResolver, appRef, injector) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.appRef = appRef;
        this.injector = injector;
        this.toastConfigDefault = new GdaToastConfig();
    }
    selectedComponentRef(direction = 'top-right') {
        switch (direction) {
            case 'top-center':
                return 'componentRefTopCenter';
            case 'top-left':
                return 'componentRefTopLeft';
            case 'bottom-right':
                return 'componentRefBottomRight';
            case 'bottom-center':
                return 'componentRefBottomCenter';
            case 'bottom-left':
                return 'componentRefBottomLeft';
            case 'top-right':
            default:
                return 'componentRefTopRight';
        }
    }
    openToast(text, config) {
        if (!document.body.querySelector('.gda-toast-' + (config?.direction || this.toastConfigDefault.direction))) {
            this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))] = this.componentFactoryResolver
                .resolveComponentFactory(GdaToastComponent)
                .create(this.injector);
            this.appRef.attachView(this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].hostView);
            const domElem = this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].hostView
                .rootNodes[0];
            document.body.appendChild(domElem);
            this.createToast(text, config);
        }
        else {
            this.createToast(text, config);
        }
    }
    createToast(text, config) {
        const c = {
            id: 'gda-toast-' + (new Date().getTime()),
            direction: config?.direction || this.toastConfigDefault.direction,
            classToast: config?.classToast || this.toastConfigDefault.classToast,
            styleToast: config?.styleToast || this.toastConfigDefault.styleToast,
            timing: config?.timing || this.toastConfigDefault.timing,
        };
        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.push({ text: text, config: c });
        if (c.timing !== 'indeterminate') {
            setTimeout(() => {
                this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts = this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.filter((toast) => toast.config.id !== c.id);
                setTimeout(() => {
                    if (!this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.length) {
                        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.closeToast.unsubscribe();
                        this.appRef.detachView(this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].hostView);
                        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].destroy();
                    }
                }, 500);
            }, c.timing || 0);
        }
        else {
            this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.closeToast.subscribe((id) => {
                this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts = this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.filter((toast) => toast.config.id !== id);
                setTimeout(() => {
                    if (!this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.length) {
                        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.closeToast.unsubscribe();
                        this.appRef.detachView(this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].hostView);
                        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].destroy();
                    }
                }, 500);
            });
        }
    }
}
GdaToast.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.0.4", ngImport: i0, type: GdaToast, deps: [{ token: i0.ComponentFactoryResolver }, { token: i0.ApplicationRef }, { token: i0.Injector }], target: i0.ɵɵFactoryTarget.Injectable });
GdaToast.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.0.4", ngImport: i0, type: GdaToast, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.0.4", ngImport: i0, type: GdaToast, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i0.ComponentFactoryResolver }, { type: i0.ApplicationRef }, { type: i0.Injector }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2RhLXRvYXN0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9nZGEtbGlicmFyeS1kZXYvcHJvamVjdHMvZ2RhLXRvYXN0L3NyYy9nZGEtdG9hc3Quc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQTZELFVBQVUsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUNoSCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQzs7QUFFMUQsTUFBTSxPQUFPLGNBQWM7SUFNekIsWUFDRSxZQUF3RyxXQUFXLEVBQ25ILGFBQXFCLEVBQUUsRUFDdkIsYUFBaUIsRUFBRSxFQUNuQixTQUFtQyxJQUFJO1FBRXZDLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzNCLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7Q0FDRjtBQUVELE1BQU0sMEJBQTJCLFNBQVEsY0FBYztJQUdyRCxZQUFZLEtBQWEsRUFBRTtRQUN6QixLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFBO0lBQ2QsQ0FBQztDQUNGO0FBS0QsTUFBTSxPQUFPLFFBQVE7SUFlbkIsWUFDVSx3QkFBa0QsRUFDbEQsTUFBc0IsRUFDdEIsUUFBa0I7UUFGbEIsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQUNsRCxXQUFNLEdBQU4sTUFBTSxDQUFnQjtRQUN0QixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBRTFCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO0lBQ2pELENBQUM7SUFFTyxvQkFBb0IsQ0FBQyxZQUF3RyxXQUFXO1FBQzlJLFFBQVEsU0FBUyxFQUFFO1lBQ2pCLEtBQUssWUFBWTtnQkFD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LENBQUM7d0JBQzVILElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxNQUFNLEVBQUUsU0FBUyxJQUFJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7d0JBQzNILElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxNQUFNLEVBQUUsU0FBUyxJQUFJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7cUJBQ3JHO2dCQUNILENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNWLENBQUMsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDOztxR0E1RlUsUUFBUTt5R0FBUixRQUFRLGNBRlAsTUFBTTsyRkFFUCxRQUFRO2tCQUhwQixVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcGxpY2F0aW9uUmVmLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIEVtYmVkZGVkVmlld1JlZiwgSW5qZWN0YWJsZSwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEdkYVRvYXN0Q29tcG9uZW50IH0gZnJvbSAnLi9nZGEtdG9hc3QuY29tcG9uZW50JztcblxuZXhwb3J0IGNsYXNzIEdkYVRvYXN0Q29uZmlnIHtcbiAgcHVibGljIGRpcmVjdGlvbjogJ3RvcC1yaWdodCcgfCAndG9wLWNlbnRlcicgfCAndG9wLWxlZnQnIHwgJ2JvdHRvbS1yaWdodCcgfCAnYm90dG9tLWNlbnRlcicgfCAnYm90dG9tLWxlZnQnO1xuICBwdWJsaWMgY2xhc3NUb2FzdD86IHN0cmluZztcbiAgcHVibGljIHN0eWxlVG9hc3Q/OiB7fTtcbiAgcHVibGljIHRpbWluZz86IG51bWJlciB8ICdpbmRldGVybWluYXRlJztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBkaXJlY3Rpb246ICd0b3AtcmlnaHQnIHwgJ3RvcC1jZW50ZXInIHwgJ3RvcC1sZWZ0JyB8ICdib3R0b20tcmlnaHQnIHwgJ2JvdHRvbS1jZW50ZXInIHwgJ2JvdHRvbS1sZWZ0JyA9ICd0b3AtcmlnaHQnLFxuICAgIGNsYXNzVG9hc3Q6IHN0cmluZyA9ICcnLFxuICAgIHN0eWxlVG9hc3Q6IHt9ID0ge30sXG4gICAgdGltaW5nOiBudW1iZXIgfCAnaW5kZXRlcm1pbmF0ZScgPSAzMDAwXG4gICkge1xuICAgIHRoaXMuZGlyZWN0aW9uID0gZGlyZWN0aW9uO1xuICAgIHRoaXMuY2xhc3NUb2FzdCA9IGNsYXNzVG9hc3Q7XG4gICAgdGhpcy5zdHlsZVRvYXN0ID0gc3R5bGVUb2FzdDtcbiAgICB0aGlzLnRpbWluZyA9IHRpbWluZztcbiAgfVxufVxuXG5jbGFzcyBHZGFUb2FzdENvbmZpZ0ZvckNvbXBvbmVudCBleHRlbmRzIEdkYVRvYXN0Q29uZmlnIHtcbiAgcHVibGljIGlkOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoaWQ6IHN0cmluZyA9ICcnKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmlkID0gaWRcbiAgfVxufVxuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBHZGFUb2FzdCB7XG4gIC8qKlxuICAgKiBDb25maWcgZGVmYXVsdFxuICAgKi9cbiAgcHVibGljIHRvYXN0Q29uZmlnRGVmYXVsdDogR2RhVG9hc3RDb25maWc7XG4gIC8qKlxuICAgKiBDb21wb25lbnQgUkVGc1xuICAgKi9cbiAgcHJpdmF0ZSBjb21wb25lbnRSZWZUb3BSaWdodDogYW55O1xuICBwcml2YXRlIGNvbXBvbmVudFJlZlRvcENlbnRlcjogYW55O1xuICBwcml2YXRlIGNvbXBvbmVudFJlZlRvcExlZnQ6IGFueTtcbiAgcHJpdmF0ZSBjb21wb25lbnRSZWZCb3R0b21SaWdodDogYW55O1xuICBwcml2YXRlIGNvbXBvbmVudFJlZkJvdHRvbUNlbnRlcjogYW55O1xuICBwcml2YXRlIGNvbXBvbmVudFJlZkJvdHRvbUxlZnQ6IGFueTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgIHByaXZhdGUgYXBwUmVmOiBBcHBsaWNhdGlvblJlZixcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvclxuICApIHtcbiAgICB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdCA9IG5ldyBHZGFUb2FzdENvbmZpZygpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZWxlY3RlZENvbXBvbmVudFJlZihkaXJlY3Rpb246ICd0b3AtcmlnaHQnIHwgJ3RvcC1jZW50ZXInIHwgJ3RvcC1sZWZ0JyB8ICdib3R0b20tcmlnaHQnIHwgJ2JvdHRvbS1jZW50ZXInIHwgJ2JvdHRvbS1sZWZ0JyA9ICd0b3AtcmlnaHQnKSB7XG4gICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcbiAgICAgIGNhc2UgJ3RvcC1jZW50ZXInOlxuICAgICAgICByZXR1cm4gJ2NvbXBvbmVudFJlZlRvcENlbnRlcic7XG4gICAgICBjYXNlICd0b3AtbGVmdCc6XG4gICAgICAgIHJldHVybiAnY29tcG9uZW50UmVmVG9wTGVmdCc7XG4gICAgICBjYXNlICdib3R0b20tcmlnaHQnOlxuICAgICAgICByZXR1cm4gJ2NvbXBvbmVudFJlZkJvdHRvbVJpZ2h0JztcbiAgICAgIGNhc2UgJ2JvdHRvbS1jZW50ZXInOlxuICAgICAgICByZXR1cm4gJ2NvbXBvbmVudFJlZkJvdHRvbUNlbnRlcic7XG4gICAgICBjYXNlICdib3R0b20tbGVmdCc6XG4gICAgICAgIHJldHVybiAnY29tcG9uZW50UmVmQm90dG9tTGVmdCc7XG4gICAgICBjYXNlICd0b3AtcmlnaHQnOlxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuICdjb21wb25lbnRSZWZUb3BSaWdodCc7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG9wZW5Ub2FzdCh0ZXh0OiBzdHJpbmcsIGNvbmZpZz86IEdkYVRvYXN0Q29uZmlnKTogdm9pZCB7XG4gICAgaWYgKCFkb2N1bWVudC5ib2R5LnF1ZXJ5U2VsZWN0b3IoJy5nZGEtdG9hc3QtJyArIChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKSkge1xuICAgICAgdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0gPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlclxuICAgICAgICAucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoR2RhVG9hc3RDb21wb25lbnQpXG4gICAgICAgIC5jcmVhdGUodGhpcy5pbmplY3Rvcik7XG5cbiAgICAgIHRoaXMuYXBwUmVmLmF0dGFjaFZpZXcodGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaG9zdFZpZXcpO1xuXG4gICAgICBjb25zdCBkb21FbGVtID0gKHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmhvc3RWaWV3IGFzIEVtYmVkZGVkVmlld1JlZjxhbnk+KVxuICAgICAgICAucm9vdE5vZGVzWzBdIGFzIEhUTUxFbGVtZW50O1xuXG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRvbUVsZW0pO1xuXG4gICAgICB0aGlzLmNyZWF0ZVRvYXN0KHRleHQsIGNvbmZpZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY3JlYXRlVG9hc3QodGV4dCwgY29uZmlnKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVRvYXN0KHRleHQ6IHN0cmluZywgY29uZmlnPzogR2RhVG9hc3RDb25maWcpOiB2b2lkIHtcbiAgICBjb25zdCBjOiBHZGFUb2FzdENvbmZpZ0ZvckNvbXBvbmVudCA9IHtcbiAgICAgIGlkOiAnZ2RhLXRvYXN0LScgKyAobmV3IERhdGUoKS5nZXRUaW1lKCkpLFxuICAgICAgZGlyZWN0aW9uOiBjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24sXG4gICAgICBjbGFzc1RvYXN0OiBjb25maWc/LmNsYXNzVG9hc3QgfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuY2xhc3NUb2FzdCxcbiAgICAgIHN0eWxlVG9hc3Q6IGNvbmZpZz8uc3R5bGVUb2FzdCB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5zdHlsZVRvYXN0LFxuICAgICAgdGltaW5nOiBjb25maWc/LnRpbWluZyB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC50aW1pbmcsXG4gICAgfVxuICAgIHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmluc3RhbmNlLnRvYXN0cy5wdXNoKHsgdGV4dDogdGV4dCwgY29uZmlnOiBjIH0pO1xuICAgIGlmIChjLnRpbWluZyAhPT0gJ2luZGV0ZXJtaW5hdGUnKSB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UudG9hc3RzID0gdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UudG9hc3RzLmZpbHRlcigodG9hc3Q6IHsgdGV4dDogc3RyaW5nLCBjb25maWc6IEdkYVRvYXN0Q29uZmlnRm9yQ29tcG9uZW50IH0pID0+IHRvYXN0LmNvbmZpZy5pZCAhPT0gYy5pZCk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGlmICghdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UudG9hc3RzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UuY2xvc2VUb2FzdC51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgdGhpcy5hcHBSZWYuZGV0YWNoVmlldyh0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5ob3N0Vmlldyk7XG4gICAgICAgICAgICB0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5kZXN0cm95KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCA1MDApO1xuICAgICAgfSwgYy50aW1pbmcgfHwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmluc3RhbmNlLmNsb3NlVG9hc3Quc3Vic2NyaWJlKChpZDogc3RyaW5nKSA9PiB7XG4gICAgICAgIHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmluc3RhbmNlLnRvYXN0cyA9IHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmluc3RhbmNlLnRvYXN0cy5maWx0ZXIoKHRvYXN0OiB7IHRleHQ6IHN0cmluZywgY29uZmlnOiBHZGFUb2FzdENvbmZpZ0ZvckNvbXBvbmVudCB9KSA9PiB0b2FzdC5jb25maWcuaWQgIT09IGlkKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgaWYgKCF0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5pbnN0YW5jZS50b2FzdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5pbnN0YW5jZS5jbG9zZVRvYXN0LnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB0aGlzLmFwcFJlZi5kZXRhY2hWaWV3KHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmhvc3RWaWV3KTtcbiAgICAgICAgICAgIHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmRlc3Ryb3koKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIDUwMCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==