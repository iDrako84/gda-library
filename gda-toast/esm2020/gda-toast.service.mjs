import { Injectable } from '@angular/core';
import { GdaToastComponent } from './gda-toast.component';
/* RXJS */
import { of, delay } from 'rxjs';
import * as i0 from "@angular/core";
export class GdaToastConfig {
    constructor(direction = 'top-right', classToast = '', styleToast = {}, timing = 3000) {
        this.direction = direction;
        this.classToast = classToast;
        this.styleToast = styleToast;
        this.timing = timing;
    }
}
class GdaToastConfigForComponent extends GdaToastConfig {
    constructor(id = '') {
        super();
        this.id = id;
    }
}
export class GdaToast {
    constructor(componentFactoryResolver, appRef, injector) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.appRef = appRef;
        this.injector = injector;
        this.toastConfigDefault = new GdaToastConfig();
    }
    selectedComponentRef(direction = 'top-right') {
        switch (direction) {
            case 'top-center':
                return 'componentRefTopCenter';
            case 'top-left':
                return 'componentRefTopLeft';
            case 'bottom-right':
                return 'componentRefBottomRight';
            case 'bottom-center':
                return 'componentRefBottomCenter';
            case 'bottom-left':
                return 'componentRefBottomLeft';
            case 'top-right':
            default:
                return 'componentRefTopRight';
        }
    }
    openToast(text, config) {
        if (!document.body.querySelector('.gda-toast-' + (config?.direction || this.toastConfigDefault.direction))) {
            this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))] = this.componentFactoryResolver
                .resolveComponentFactory(GdaToastComponent)
                .create(this.injector);
            this.appRef.attachView(this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].hostView);
            const domElem = this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].hostView
                .rootNodes[0];
            document.body.appendChild(domElem);
            this.createToast(text, config);
        }
        else {
            this.createToast(text, config);
        }
    }
    createToast(text, config) {
        const c = {
            id: 'gda-toast-' + (new Date().getTime()),
            direction: config?.direction || this.toastConfigDefault.direction,
            classToast: config?.classToast || this.toastConfigDefault.classToast,
            styleToast: config?.styleToast || this.toastConfigDefault.styleToast,
            timing: config?.timing || this.toastConfigDefault.timing,
        };
        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.push({ text: text, config: c });
        if (c.timing !== 'indeterminate') {
            of(true).pipe(delay(c.timing || 0)).subscribe(() => {
                this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts = this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.filter((toast) => toast.config.id !== c.id);
                of(true).pipe(delay(500)).subscribe(() => {
                    if (!this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.length) {
                        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.closeToast.unsubscribe();
                        this.appRef.detachView(this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].hostView);
                        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].destroy();
                    }
                });
            });
        }
        else {
            this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.closeToast.subscribe((id) => {
                this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts = this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.filter((toast) => toast.config.id !== id);
                of(true).pipe(delay(500)).subscribe(() => {
                    if (!this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.length) {
                        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.closeToast.unsubscribe();
                        this.appRef.detachView(this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].hostView);
                        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].destroy();
                    }
                });
            });
        }
    }
}
GdaToast.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.1.0", ngImport: i0, type: GdaToast, deps: [{ token: i0.ComponentFactoryResolver }, { token: i0.ApplicationRef }, { token: i0.Injector }], target: i0.ɵɵFactoryTarget.Injectable });
GdaToast.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.1.0", ngImport: i0, type: GdaToast, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.1.0", ngImport: i0, type: GdaToast, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i0.ComponentFactoryResolver }, { type: i0.ApplicationRef }, { type: i0.Injector }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2RhLXRvYXN0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9nZGEtbGlicmFyeS1kZXYvcHJvamVjdHMvZ2RhLXRvYXN0L3NyYy9nZGEtdG9hc3Quc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQTZELFVBQVUsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUNoSCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxVQUFVO0FBQ1YsT0FBTyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7O0FBRWpDLE1BQU0sT0FBTyxjQUFjO0lBTXpCLFlBQ0UsWUFBd0csV0FBVyxFQUNuSCxhQUFxQixFQUFFLEVBQ3ZCLGFBQWlCLEVBQUUsRUFDbkIsU0FBbUMsSUFBSTtRQUV2QyxJQUFJLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztRQUMzQixJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0NBQ0Y7QUFFRCxNQUFNLDBCQUEyQixTQUFRLGNBQWM7SUFHckQsWUFBWSxLQUFhLEVBQUU7UUFDekIsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQTtJQUNkLENBQUM7Q0FDRjtBQUtELE1BQU0sT0FBTyxRQUFRO0lBZW5CLFlBQ1Usd0JBQWtELEVBQ2xELE1BQXNCLEVBQ3RCLFFBQWtCO1FBRmxCLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsV0FBTSxHQUFOLE1BQU0sQ0FBZ0I7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUUxQixJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxjQUFjLEVBQUUsQ0FBQztJQUNqRCxDQUFDO0lBRU8sb0JB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LE1BQU0sRUFBRSxTQUFTLElBQUksSUFBSSxDQUFDLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTt3QkFDckgsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLE1BQU0sRUFBRSxTQUFTLElBQUksSUFBSSxDQUFDLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDO3dCQUM1SCxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsTUFBTSxFQUFFLFNBQVMsSUFBSSxJQUFJLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUMzSCxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsTUFBTSxFQUFFLFNBQVMsSUFBSSxJQUFJLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO3FCQUNyRztnQkFDSCxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDOztxR0E1RlUsUUFBUTt5R0FBUixRQUFRLGNBRlAsTUFBTTsyRkFFUCxRQUFRO2tCQUhwQixVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcGxpY2F0aW9uUmVmLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIEVtYmVkZGVkVmlld1JlZiwgSW5qZWN0YWJsZSwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgR2RhVG9hc3RDb21wb25lbnQgfSBmcm9tICcuL2dkYS10b2FzdC5jb21wb25lbnQnO1xyXG4vKiBSWEpTICovXHJcbmltcG9ydCB7IG9mLCBkZWxheSB9IGZyb20gJ3J4anMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIEdkYVRvYXN0Q29uZmlnIHtcclxuICBwdWJsaWMgZGlyZWN0aW9uOiAndG9wLXJpZ2h0JyB8ICd0b3AtY2VudGVyJyB8ICd0b3AtbGVmdCcgfCAnYm90dG9tLXJpZ2h0JyB8ICdib3R0b20tY2VudGVyJyB8ICdib3R0b20tbGVmdCc7XHJcbiAgcHVibGljIGNsYXNzVG9hc3Q/OiBzdHJpbmc7XHJcbiAgcHVibGljIHN0eWxlVG9hc3Q/OiB7fTtcclxuICBwdWJsaWMgdGltaW5nPzogbnVtYmVyIHwgJ2luZGV0ZXJtaW5hdGUnO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGRpcmVjdGlvbjogJ3RvcC1yaWdodCcgfCAndG9wLWNlbnRlcicgfCAndG9wLWxlZnQnIHwgJ2JvdHRvbS1yaWdodCcgfCAnYm90dG9tLWNlbnRlcicgfCAnYm90dG9tLWxlZnQnID0gJ3RvcC1yaWdodCcsXHJcbiAgICBjbGFzc1RvYXN0OiBzdHJpbmcgPSAnJyxcclxuICAgIHN0eWxlVG9hc3Q6IHt9ID0ge30sXHJcbiAgICB0aW1pbmc6IG51bWJlciB8ICdpbmRldGVybWluYXRlJyA9IDMwMDBcclxuICApIHtcclxuICAgIHRoaXMuZGlyZWN0aW9uID0gZGlyZWN0aW9uO1xyXG4gICAgdGhpcy5jbGFzc1RvYXN0ID0gY2xhc3NUb2FzdDtcclxuICAgIHRoaXMuc3R5bGVUb2FzdCA9IHN0eWxlVG9hc3Q7XHJcbiAgICB0aGlzLnRpbWluZyA9IHRpbWluZztcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIEdkYVRvYXN0Q29uZmlnRm9yQ29tcG9uZW50IGV4dGVuZHMgR2RhVG9hc3RDb25maWcge1xyXG4gIHB1YmxpYyBpZDogc3RyaW5nO1xyXG5cclxuICBjb25zdHJ1Y3RvcihpZDogc3RyaW5nID0gJycpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLmlkID0gaWRcclxuICB9XHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiAncm9vdCdcclxufSlcclxuZXhwb3J0IGNsYXNzIEdkYVRvYXN0IHtcclxuICAvKipcclxuICAgKiBDb25maWcgZGVmYXVsdFxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b2FzdENvbmZpZ0RlZmF1bHQ6IEdkYVRvYXN0Q29uZmlnO1xyXG4gIC8qKlxyXG4gICAqIENvbXBvbmVudCBSRUZzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjb21wb25lbnRSZWZUb3BSaWdodDogYW55O1xyXG4gIHByaXZhdGUgY29tcG9uZW50UmVmVG9wQ2VudGVyOiBhbnk7XHJcbiAgcHJpdmF0ZSBjb21wb25lbnRSZWZUb3BMZWZ0OiBhbnk7XHJcbiAgcHJpdmF0ZSBjb21wb25lbnRSZWZCb3R0b21SaWdodDogYW55O1xyXG4gIHByaXZhdGUgY29tcG9uZW50UmVmQm90dG9tQ2VudGVyOiBhbnk7XHJcbiAgcHJpdmF0ZSBjb21wb25lbnRSZWZCb3R0b21MZWZ0OiBhbnk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHByaXZhdGUgYXBwUmVmOiBBcHBsaWNhdGlvblJlZixcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yXHJcbiAgKSB7XHJcbiAgICB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdCA9IG5ldyBHZGFUb2FzdENvbmZpZygpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZWxlY3RlZENvbXBvbmVudFJlZihkaXJlY3Rpb246ICd0b3AtcmlnaHQnIHwgJ3RvcC1jZW50ZXInIHwgJ3RvcC1sZWZ0JyB8ICdib3R0b20tcmlnaHQnIHwgJ2JvdHRvbS1jZW50ZXInIHwgJ2JvdHRvbS1sZWZ0JyA9ICd0b3AtcmlnaHQnKSB7XHJcbiAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xyXG4gICAgICBjYXNlICd0b3AtY2VudGVyJzpcclxuICAgICAgICByZXR1cm4gJ2NvbXBvbmVudFJlZlRvcENlbnRlcic7XHJcbiAgICAgIGNhc2UgJ3RvcC1sZWZ0JzpcclxuICAgICAgICByZXR1cm4gJ2NvbXBvbmVudFJlZlRvcExlZnQnO1xyXG4gICAgICBjYXNlICdib3R0b20tcmlnaHQnOlxyXG4gICAgICAgIHJldHVybiAnY29tcG9uZW50UmVmQm90dG9tUmlnaHQnO1xyXG4gICAgICBjYXNlICdib3R0b20tY2VudGVyJzpcclxuICAgICAgICByZXR1cm4gJ2NvbXBvbmVudFJlZkJvdHRvbUNlbnRlcic7XHJcbiAgICAgIGNhc2UgJ2JvdHRvbS1sZWZ0JzpcclxuICAgICAgICByZXR1cm4gJ2NvbXBvbmVudFJlZkJvdHRvbUxlZnQnO1xyXG4gICAgICBjYXNlICd0b3AtcmlnaHQnOlxyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJldHVybiAnY29tcG9uZW50UmVmVG9wUmlnaHQnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIG9wZW5Ub2FzdCh0ZXh0OiBzdHJpbmcsIGNvbmZpZz86IEdkYVRvYXN0Q29uZmlnKTogdm9pZCB7XHJcbiAgICBpZiAoIWRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvcignLmdkYS10b2FzdC0nICsgKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpKSB7XHJcbiAgICAgIHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXJcclxuICAgICAgICAucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoR2RhVG9hc3RDb21wb25lbnQpXHJcbiAgICAgICAgLmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuXHJcbiAgICAgIHRoaXMuYXBwUmVmLmF0dGFjaFZpZXcodGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaG9zdFZpZXcpO1xyXG5cclxuICAgICAgY29uc3QgZG9tRWxlbSA9ICh0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5ob3N0VmlldyBhcyBFbWJlZGRlZFZpZXdSZWY8YW55PilcclxuICAgICAgICAucm9vdE5vZGVzWzBdIGFzIEhUTUxFbGVtZW50O1xyXG5cclxuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkb21FbGVtKTtcclxuXHJcbiAgICAgIHRoaXMuY3JlYXRlVG9hc3QodGV4dCwgY29uZmlnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuY3JlYXRlVG9hc3QodGV4dCwgY29uZmlnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlVG9hc3QodGV4dDogc3RyaW5nLCBjb25maWc/OiBHZGFUb2FzdENvbmZpZyk6IHZvaWQge1xyXG4gICAgY29uc3QgYzogR2RhVG9hc3RDb25maWdGb3JDb21wb25lbnQgPSB7XHJcbiAgICAgIGlkOiAnZ2RhLXRvYXN0LScgKyAobmV3IERhdGUoKS5nZXRUaW1lKCkpLFxyXG4gICAgICBkaXJlY3Rpb246IGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbixcclxuICAgICAgY2xhc3NUb2FzdDogY29uZmlnPy5jbGFzc1RvYXN0IHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmNsYXNzVG9hc3QsXHJcbiAgICAgIHN0eWxlVG9hc3Q6IGNvbmZpZz8uc3R5bGVUb2FzdCB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5zdHlsZVRvYXN0LFxyXG4gICAgICB0aW1pbmc6IGNvbmZpZz8udGltaW5nIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LnRpbWluZyxcclxuICAgIH1cclxuICAgIHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmluc3RhbmNlLnRvYXN0cy5wdXNoKHsgdGV4dDogdGV4dCwgY29uZmlnOiBjIH0pO1xyXG4gICAgaWYgKGMudGltaW5nICE9PSAnaW5kZXRlcm1pbmF0ZScpIHtcclxuICAgICAgb2YodHJ1ZSkucGlwZShkZWxheShjLnRpbWluZyB8fCAwKSkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICB0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5pbnN0YW5jZS50b2FzdHMgPSB0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5pbnN0YW5jZS50b2FzdHMuZmlsdGVyKCh0b2FzdDogeyB0ZXh0OiBzdHJpbmcsIGNvbmZpZzogR2RhVG9hc3RDb25maWdGb3JDb21wb25lbnQgfSkgPT4gdG9hc3QuY29uZmlnLmlkICE9PSBjLmlkKTtcclxuICAgICAgICBvZih0cnVlKS5waXBlKGRlbGF5KDUwMCkpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICBpZiAoIXRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmluc3RhbmNlLnRvYXN0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UuY2xvc2VUb2FzdC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmFwcFJlZi5kZXRhY2hWaWV3KHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmhvc3RWaWV3KTtcclxuICAgICAgICAgICAgdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uZGVzdHJveSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmluc3RhbmNlLmNsb3NlVG9hc3Quc3Vic2NyaWJlKChpZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UudG9hc3RzID0gdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UudG9hc3RzLmZpbHRlcigodG9hc3Q6IHsgdGV4dDogc3RyaW5nLCBjb25maWc6IEdkYVRvYXN0Q29uZmlnRm9yQ29tcG9uZW50IH0pID0+IHRvYXN0LmNvbmZpZy5pZCAhPT0gaWQpO1xyXG4gICAgICAgIG9mKHRydWUpLnBpcGUoZGVsYXkoNTAwKSkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgIGlmICghdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UudG9hc3RzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5pbnN0YW5jZS5jbG9zZVRvYXN0LnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwUmVmLmRldGFjaFZpZXcodGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaG9zdFZpZXcpO1xyXG4gICAgICAgICAgICB0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5kZXN0cm95KCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=