import { Injectable } from '@angular/core';
import { GdaToastComponent } from './gda-toast.component';
/* RXJS */
import { of, delay } from 'rxjs';
import * as i0 from "@angular/core";
export class GdaToastConfig {
    constructor(direction = 'top-right', classToast = '', styleToast = {}, timing = 3000) {
        this.direction = direction;
        this.classToast = classToast;
        this.styleToast = styleToast;
        this.timing = timing;
    }
}
class GdaToastConfigForComponent extends GdaToastConfig {
    constructor(id = '') {
        super();
        this.id = id;
    }
}
export class GdaToast {
    constructor(componentFactoryResolver, appRef, injector) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.appRef = appRef;
        this.injector = injector;
        this.toastConfigDefault = new GdaToastConfig();
    }
    selectedComponentRef(direction = 'top-right') {
        switch (direction) {
            case 'top-center':
                return 'componentRefTopCenter';
            case 'top-left':
                return 'componentRefTopLeft';
            case 'bottom-right':
                return 'componentRefBottomRight';
            case 'bottom-center':
                return 'componentRefBottomCenter';
            case 'bottom-left':
                return 'componentRefBottomLeft';
            case 'top-right':
            default:
                return 'componentRefTopRight';
        }
    }
    openToast(text, config) {
        if (!document.body.querySelector('.gda-toast-' + (config?.direction || this.toastConfigDefault.direction))) {
            this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))] = this.componentFactoryResolver
                .resolveComponentFactory(GdaToastComponent)
                .create(this.injector);
            this.appRef.attachView(this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].hostView);
            const domElem = this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].hostView
                .rootNodes[0];
            document.body.appendChild(domElem);
            this.createToast(text, config);
        }
        else {
            this.createToast(text, config);
        }
    }
    createToast(text, config) {
        const c = {
            id: 'gda-toast-' + (new Date().getTime()),
            direction: config?.direction || this.toastConfigDefault.direction,
            classToast: config?.classToast || this.toastConfigDefault.classToast,
            styleToast: config?.styleToast || this.toastConfigDefault.styleToast,
            timing: config?.timing || this.toastConfigDefault.timing,
        };
        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.push({ text: text, config: c });
        if (c.timing !== 'indeterminate') {
            of(true).pipe(delay(c.timing || 0)).subscribe(() => {
                this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts = this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.filter((toast) => toast.config.id !== c.id);
                of(true).pipe(delay(500)).subscribe(() => {
                    if (!this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.length) {
                        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.closeToast.unsubscribe();
                        this.appRef.detachView(this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].hostView);
                        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].destroy();
                    }
                });
            });
        }
        else {
            this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.closeToast.subscribe((id) => {
                this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts = this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.filter((toast) => toast.config.id !== id);
                of(true).pipe(delay(500)).subscribe(() => {
                    if (!this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.toasts.length) {
                        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].instance.closeToast.unsubscribe();
                        this.appRef.detachView(this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].hostView);
                        this[this.selectedComponentRef((config?.direction || this.toastConfigDefault.direction))].destroy();
                    }
                });
            });
        }
    }
}
GdaToast.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.6", ngImport: i0, type: GdaToast, deps: [{ token: i0.ComponentFactoryResolver }, { token: i0.ApplicationRef }, { token: i0.Injector }], target: i0.ɵɵFactoryTarget.Injectable });
GdaToast.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.3.6", ngImport: i0, type: GdaToast, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.6", ngImport: i0, type: GdaToast, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i0.ComponentFactoryResolver }, { type: i0.ApplicationRef }, { type: i0.Injector }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2RhLXRvYXN0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9wcm9qZWN0cy9nZGEtdG9hc3Qvc3JjL2dkYS10b2FzdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBNkQsVUFBVSxFQUFZLE1BQU0sZUFBZSxDQUFDO0FBQ2hILE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELFVBQVU7QUFDVixPQUFPLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQzs7QUFFakMsTUFBTSxPQUFPLGNBQWM7SUFNekIsWUFDRSxZQUF3RyxXQUFXLEVBQ25ILGFBQXFCLEVBQUUsRUFDdkIsYUFBaUIsRUFBRSxFQUNuQixTQUFtQyxJQUFJO1FBRXZDLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzNCLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7Q0FDRjtBQUVELE1BQU0sMEJBQTJCLFNBQVEsY0FBYztJQUdyRCxZQUFZLEtBQWEsRUFBRTtRQUN6QixLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFBO0lBQ2QsQ0FBQztDQUNGO0FBS0QsTUFBTSxPQUFPLFFBQVE7SUFlbkIsWUFDVSx3QkFBa0QsRUFDbEQsTUFBc0IsRUFDdEIsUUFBa0I7UUFGbEIsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQUNsRCxXQUFNLEdBQU4sTUFBTSxDQUFnQjtRQUN0QixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBRTFCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO0lBQ2pELENBQUM7SUFFTyxvQkFBb0IsQ0FBQyxZQUF3RyxX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SUFBSSxJQUFJLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFO3dCQUNySCxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsTUFBTSxFQUFFLFNBQVMsSUFBSSxJQUFJLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsV0FBVyxFQUFFLENBQUM7d0JBQzVILElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxNQUFNLEVBQUUsU0FBUyxJQUFJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7d0JBQzNILElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxNQUFNLEVBQUUsU0FBUyxJQUFJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7cUJBQ3JHO2dCQUNILENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7U0FDSjtJQUNILENBQUM7O3FHQTVGVSxRQUFRO3lHQUFSLFFBQVEsY0FGUCxNQUFNOzJGQUVQLFFBQVE7a0JBSHBCLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwbGljYXRpb25SZWYsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgRW1iZWRkZWRWaWV3UmVmLCBJbmplY3RhYmxlLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgR2RhVG9hc3RDb21wb25lbnQgfSBmcm9tICcuL2dkYS10b2FzdC5jb21wb25lbnQnO1xuLyogUlhKUyAqL1xuaW1wb3J0IHsgb2YsIGRlbGF5IH0gZnJvbSAncnhqcyc7XG5cbmV4cG9ydCBjbGFzcyBHZGFUb2FzdENvbmZpZyB7XG4gIHB1YmxpYyBkaXJlY3Rpb246ICd0b3AtcmlnaHQnIHwgJ3RvcC1jZW50ZXInIHwgJ3RvcC1sZWZ0JyB8ICdib3R0b20tcmlnaHQnIHwgJ2JvdHRvbS1jZW50ZXInIHwgJ2JvdHRvbS1sZWZ0JztcbiAgcHVibGljIGNsYXNzVG9hc3Q/OiBzdHJpbmc7XG4gIHB1YmxpYyBzdHlsZVRvYXN0Pzoge307XG4gIHB1YmxpYyB0aW1pbmc/OiBudW1iZXIgfCAnaW5kZXRlcm1pbmF0ZSc7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgZGlyZWN0aW9uOiAndG9wLXJpZ2h0JyB8ICd0b3AtY2VudGVyJyB8ICd0b3AtbGVmdCcgfCAnYm90dG9tLXJpZ2h0JyB8ICdib3R0b20tY2VudGVyJyB8ICdib3R0b20tbGVmdCcgPSAndG9wLXJpZ2h0JyxcbiAgICBjbGFzc1RvYXN0OiBzdHJpbmcgPSAnJyxcbiAgICBzdHlsZVRvYXN0OiB7fSA9IHt9LFxuICAgIHRpbWluZzogbnVtYmVyIHwgJ2luZGV0ZXJtaW5hdGUnID0gMzAwMFxuICApIHtcbiAgICB0aGlzLmRpcmVjdGlvbiA9IGRpcmVjdGlvbjtcbiAgICB0aGlzLmNsYXNzVG9hc3QgPSBjbGFzc1RvYXN0O1xuICAgIHRoaXMuc3R5bGVUb2FzdCA9IHN0eWxlVG9hc3Q7XG4gICAgdGhpcy50aW1pbmcgPSB0aW1pbmc7XG4gIH1cbn1cblxuY2xhc3MgR2RhVG9hc3RDb25maWdGb3JDb21wb25lbnQgZXh0ZW5kcyBHZGFUb2FzdENvbmZpZyB7XG4gIHB1YmxpYyBpZDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGlkOiBzdHJpbmcgPSAnJykge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5pZCA9IGlkXG4gIH1cbn1cblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgR2RhVG9hc3Qge1xuICAvKipcbiAgICogQ29uZmlnIGRlZmF1bHRcbiAgICovXG4gIHB1YmxpYyB0b2FzdENvbmZpZ0RlZmF1bHQ6IEdkYVRvYXN0Q29uZmlnO1xuICAvKipcbiAgICogQ29tcG9uZW50IFJFRnNcbiAgICovXG4gIHByaXZhdGUgY29tcG9uZW50UmVmVG9wUmlnaHQ6IGFueTtcbiAgcHJpdmF0ZSBjb21wb25lbnRSZWZUb3BDZW50ZXI6IGFueTtcbiAgcHJpdmF0ZSBjb21wb25lbnRSZWZUb3BMZWZ0OiBhbnk7XG4gIHByaXZhdGUgY29tcG9uZW50UmVmQm90dG9tUmlnaHQ6IGFueTtcbiAgcHJpdmF0ZSBjb21wb25lbnRSZWZCb3R0b21DZW50ZXI6IGFueTtcbiAgcHJpdmF0ZSBjb21wb25lbnRSZWZCb3R0b21MZWZ0OiBhbnk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICBwcml2YXRlIGFwcFJlZjogQXBwbGljYXRpb25SZWYsXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3JcbiAgKSB7XG4gICAgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQgPSBuZXcgR2RhVG9hc3RDb25maWcoKTtcbiAgfVxuXG4gIHByaXZhdGUgc2VsZWN0ZWRDb21wb25lbnRSZWYoZGlyZWN0aW9uOiAndG9wLXJpZ2h0JyB8ICd0b3AtY2VudGVyJyB8ICd0b3AtbGVmdCcgfCAnYm90dG9tLXJpZ2h0JyB8ICdib3R0b20tY2VudGVyJyB8ICdib3R0b20tbGVmdCcgPSAndG9wLXJpZ2h0Jykge1xuICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XG4gICAgICBjYXNlICd0b3AtY2VudGVyJzpcbiAgICAgICAgcmV0dXJuICdjb21wb25lbnRSZWZUb3BDZW50ZXInO1xuICAgICAgY2FzZSAndG9wLWxlZnQnOlxuICAgICAgICByZXR1cm4gJ2NvbXBvbmVudFJlZlRvcExlZnQnO1xuICAgICAgY2FzZSAnYm90dG9tLXJpZ2h0JzpcbiAgICAgICAgcmV0dXJuICdjb21wb25lbnRSZWZCb3R0b21SaWdodCc7XG4gICAgICBjYXNlICdib3R0b20tY2VudGVyJzpcbiAgICAgICAgcmV0dXJuICdjb21wb25lbnRSZWZCb3R0b21DZW50ZXInO1xuICAgICAgY2FzZSAnYm90dG9tLWxlZnQnOlxuICAgICAgICByZXR1cm4gJ2NvbXBvbmVudFJlZkJvdHRvbUxlZnQnO1xuICAgICAgY2FzZSAndG9wLXJpZ2h0JzpcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiAnY29tcG9uZW50UmVmVG9wUmlnaHQnO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBvcGVuVG9hc3QodGV4dDogc3RyaW5nLCBjb25maWc/OiBHZGFUb2FzdENvbmZpZyk6IHZvaWQge1xuICAgIGlmICghZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yKCcuZ2RhLXRvYXN0LScgKyAoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSkpIHtcbiAgICAgIHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXJcbiAgICAgICAgLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEdkYVRvYXN0Q29tcG9uZW50KVxuICAgICAgICAuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xuXG4gICAgICB0aGlzLmFwcFJlZi5hdHRhY2hWaWV3KHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmhvc3RWaWV3KTtcblxuICAgICAgY29uc3QgZG9tRWxlbSA9ICh0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5ob3N0VmlldyBhcyBFbWJlZGRlZFZpZXdSZWY8YW55PilcbiAgICAgICAgLnJvb3ROb2Rlc1swXSBhcyBIVE1MRWxlbWVudDtcblxuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkb21FbGVtKTtcblxuICAgICAgdGhpcy5jcmVhdGVUb2FzdCh0ZXh0LCBjb25maWcpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNyZWF0ZVRvYXN0KHRleHQsIGNvbmZpZyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUb2FzdCh0ZXh0OiBzdHJpbmcsIGNvbmZpZz86IEdkYVRvYXN0Q29uZmlnKTogdm9pZCB7XG4gICAgY29uc3QgYzogR2RhVG9hc3RDb25maWdGb3JDb21wb25lbnQgPSB7XG4gICAgICBpZDogJ2dkYS10b2FzdC0nICsgKG5ldyBEYXRlKCkuZ2V0VGltZSgpKSxcbiAgICAgIGRpcmVjdGlvbjogY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uLFxuICAgICAgY2xhc3NUb2FzdDogY29uZmlnPy5jbGFzc1RvYXN0IHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmNsYXNzVG9hc3QsXG4gICAgICBzdHlsZVRvYXN0OiBjb25maWc/LnN0eWxlVG9hc3QgfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuc3R5bGVUb2FzdCxcbiAgICAgIHRpbWluZzogY29uZmlnPy50aW1pbmcgfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQudGltaW5nLFxuICAgIH1cbiAgICB0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5pbnN0YW5jZS50b2FzdHMucHVzaCh7IHRleHQ6IHRleHQsIGNvbmZpZzogYyB9KTtcbiAgICBpZiAoYy50aW1pbmcgIT09ICdpbmRldGVybWluYXRlJykge1xuICAgICAgb2YodHJ1ZSkucGlwZShkZWxheShjLnRpbWluZyB8fCAwKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UudG9hc3RzID0gdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UudG9hc3RzLmZpbHRlcigodG9hc3Q6IHsgdGV4dDogc3RyaW5nLCBjb25maWc6IEdkYVRvYXN0Q29uZmlnRm9yQ29tcG9uZW50IH0pID0+IHRvYXN0LmNvbmZpZy5pZCAhPT0gYy5pZCk7XG4gICAgICAgIG9mKHRydWUpLnBpcGUoZGVsYXkoNTAwKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICBpZiAoIXRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmluc3RhbmNlLnRvYXN0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmluc3RhbmNlLmNsb3NlVG9hc3QudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIHRoaXMuYXBwUmVmLmRldGFjaFZpZXcodGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaG9zdFZpZXcpO1xuICAgICAgICAgICAgdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uZGVzdHJveSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UuY2xvc2VUb2FzdC5zdWJzY3JpYmUoKGlkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UudG9hc3RzID0gdGhpc1t0aGlzLnNlbGVjdGVkQ29tcG9uZW50UmVmKChjb25maWc/LmRpcmVjdGlvbiB8fCB0aGlzLnRvYXN0Q29uZmlnRGVmYXVsdC5kaXJlY3Rpb24pKV0uaW5zdGFuY2UudG9hc3RzLmZpbHRlcigodG9hc3Q6IHsgdGV4dDogc3RyaW5nLCBjb25maWc6IEdkYVRvYXN0Q29uZmlnRm9yQ29tcG9uZW50IH0pID0+IHRvYXN0LmNvbmZpZy5pZCAhPT0gaWQpO1xuICAgICAgICBvZih0cnVlKS5waXBlKGRlbGF5KDUwMCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgaWYgKCF0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5pbnN0YW5jZS50b2FzdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzW3RoaXMuc2VsZWN0ZWRDb21wb25lbnRSZWYoKGNvbmZpZz8uZGlyZWN0aW9uIHx8IHRoaXMudG9hc3RDb25maWdEZWZhdWx0LmRpcmVjdGlvbikpXS5pbnN0YW5jZS5jbG9zZVRvYXN0LnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB0aGlzLmFwcFJlZi5kZXRhY2hWaWV3KHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmhvc3RWaWV3KTtcbiAgICAgICAgICAgIHRoaXNbdGhpcy5zZWxlY3RlZENvbXBvbmVudFJlZigoY29uZmlnPy5kaXJlY3Rpb24gfHwgdGhpcy50b2FzdENvbmZpZ0RlZmF1bHQuZGlyZWN0aW9uKSldLmRlc3Ryb3koKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG4iXX0=